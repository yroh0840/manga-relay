<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}{% endblock %}</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class'
    }
  </script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>

<body class="min-h-screen pt-4 pl-4 pr-4 md:pt-8 md:pl-8 md:pr-8 transition-colors duration-300
         bg-gray-100 dark:bg-[#232325]
         text-gray-800 dark:text-gray-200">

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  <div class="fixed top-4 left-1/2 -translate-x-1/2 z-50 w-full px-4">
    {% for category, message in messages %}
    <div id="flash-message" class="
          mx-auto max-w-sm
          px-4 py-3 rounded-xl shadow-lg
          text-center
          whitespace-normal break-words
          transition-all duration-500
          {% if category == 'success' %}
            bg-green-600 text-white
          {% elif category == 'error' %}
            bg-red-600 text-white
          {% else %}
            bg-gray-700 text-white
          {% endif %}
        ">
      {{ message }}
    </div>
    {% endfor %}
  </div>
  {% endif %}
  {% endwith %}

  <script>
    setTimeout(() => {
      const el = document.getElementById('flash-message');
      if (el) {
        el.classList.add("opacity-0", "translate-y-[-10px]");
        setTimeout(() => el.remove(), 700);
      }
    }, 2000); // 2.5ç§’å¾Œã«æ¶ˆãˆã‚‹
  </script>
  {% block content %}{% endblock %}

  <!-- å…±é€šã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script>
    const html = document.documentElement;
    const toggleButton = document.getElementById("theme-toggle");
    const savedTheme = localStorage.getItem("theme");

    if (savedTheme === "dark") {
      html.classList.add("dark");
      toggleButton.textContent = "â˜€ï¸";
    }

    toggleButton.addEventListener("click", () => {
      html.classList.toggle("dark");

      if (html.classList.contains("dark")) {
        localStorage.setItem("theme", "dark");
        toggleButton.textContent = "â˜€ï¸";
      } else {
        localStorage.setItem("theme", "light");
        toggleButton.textContent = "ğŸŒ™";
      }
    });
  </script>
  {% block scripts %}{% endblock %}
  <footer class="max-w-4xl mx-auto mt-16 px-4 text-center">

    {% if not hide_dm_link %}

    <!-- ===============================
       ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ã‚¨ãƒªã‚¢
  =============================== -->
    <div class="border-t pt-10 pb-6">

      <div class="max-w-xl mx-auto">

        <h3 class="text-lg font-bold mb-3 text-gray-800 dark:text-gray-100">
          ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦ã²ã¨ã“ã¨
        </h3>

        <form action="{{ url_for('footer_comment') }}" method="POST" class="space-y-3">

          <textarea name="message" rows="3" required placeholder="æ„Ÿæƒ³ã‚„ã‚¢ã‚¤ãƒ‡ã‚¢ãªã©ã€æ°—è»½ã«ã©ã†ã" class="w-full p-3 rounded-lg border
                 bg-gray-50 dark:bg-gray-800
                 text-gray-800 dark:text-gray-100
                 border-gray-300 dark:border-gray-700
                 focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>

          <label class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
            <input type="checkbox" name="is_public" checked>
            å…¬é–‹ã—ã¦ã‚‚OK
          </label>

          <button type="submit" class="px-4 py-2 rounded-lg bg-indigo-600 text-white
                 hover:bg-indigo-700 transition">
            é€ä¿¡
          </button>

          <p class="text-xs text-gray-400 leading-relaxed">
            â€» åŒ¿åã§æŠ•ç¨¿ã§ãã¾ã™ã€‚<br>
            â€» ã“ã®æ¬„ã¯ã‚µã‚¤ãƒˆã«ã¤ã„ã¦ã®æ„Ÿæƒ³ã‚„ã‚¢ã‚¤ãƒ‡ã‚¢ç”¨ã§ã™ã€‚<br>
            <!-- â€» ä¸å…·åˆã®å ±å‘Šã‚„å€‹åˆ¥ã®ç›¸è«‡ã¯ç®¡ç†è€…DMã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚ -->
          </p>

        </form>

        <!-- ç®¡ç†è€…DMãƒªãƒ³ã‚¯ -->
        <div class="mt-4">
          <a href="{{ url_for('admin_dm') }}" class="inline-flex items-center gap-1 text-sm
                  text-gray-500 hover:text-indigo-600 transition">
            ä¸å…·åˆã®å ±å‘Šã‚„å€‹åˆ¥ã®ç›¸è«‡ã¯ã“ã¡ã‚‰ â†’ ç®¡ç†è€…ã¸DM
            <span>ğŸ“©</span>
          </a>
        </div>

      </div>
    </div>

    <!-- ===============================
       å…¬é–‹ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§
  =============================== -->
    <div class="mt-12 max-w-xl mx-auto space-y-6">

      <h4 class="text-md font-semibold text-gray-700 dark:text-gray-300">
        ã¿ã‚“ãªã®ã²ã¨ã“ã¨
      </h4>

      {% if public_comments %}
      {% for c in public_comments %}
      <div class="
        p-4 rounded-xl
        bg-white dark:bg-gray-900
        border border-gray-200 dark:border-gray-700
        shadow-sm
        space-y-2
      ">

        <!-- ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ -->
        <p class="text-sm text-gray-800 dark:text-gray-100 leading-relaxed">
          {{ c.message }}
        </p>

        <!-- ç®¡ç†è€…è¿”ä¿¡ -->
        {% if c.admin_reply %}
        <div class="
          mt-3 pl-3 border-l-4 border-indigo-400
          text-xs text-gray-600 dark:text-gray-400
        ">
          <span class="font-semibold text-indigo-500">
            ç®¡ç†è€…ã‚ˆã‚Š
          </span><br>
          {{ c.admin_reply }}
        </div>
        {% endif %}

        <!-- æŠ•ç¨¿æ—¥æ™‚ -->
        <div class="text-xs text-gray-400 text-right">
          {{ c.created_at.strftime('%Y/%m/%d') }}
        </div>

      </div>
      {% endfor %}
      {% else %}
      <p class="text-sm text-gray-400">
        ã¾ã ã‚³ãƒ¡ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
      </p>
      {% endif %}

    </div>

    {% else %}

    <!-- ===============================
       DMãƒšãƒ¼ã‚¸ãªã©ã‹ã‚‰æˆ»ã‚‹ç”¨
  =============================== -->
    <a href="{{ url_for('index') }}" class="inline-block mt-6 px-4 py-2
            bg-gray-300 dark:bg-[#383C40]
            text-gray-700 dark:text-[#BFC9DD]
            rounded-lg shadow
            hover:bg-gray-400 transition">
      â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹
    </a>

    {% endif %}

  </footer>

</body>

</html>