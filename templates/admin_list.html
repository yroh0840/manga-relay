<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>ÁÆ°ÁêÜÁîªÈù¢ - Comic ÁÆ°ÁêÜ</title>

    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            padding: 20px;
            background: #f0f0f0;
        }

        .comic-box {
            position: relative;
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }

        .comic-header {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .comic-header.deleted {
            opacity: 0.4;
        }

        .thumb {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            background: #ddd;
        }

        .comic-title {
            font-size: 18px;
            font-weight: bold;
        }

        /* --- „Ç≥„Éû‰∏ÄË¶ß --- */
        .koma-grid {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }

        .koma-card {
            position: relative;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .koma-card.deleted {
            opacity: 0.4;
        }

        .deleted-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background: red;
            color: white;
            padding: 2px 6px;
            font-size: 10px;
            border-radius: 4px;
        }

        .deleted-badge-comic {
            position: absolute;
            top: 0;
            left: 0;
            background: red;
            color: white;
            padding: 2px 6px;
            font-size: 10px;
            border-radius: 4px;
        }


        .koma-card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 6px;
        }

        .delete-btn {
            display: inline-block;
            width: auto;
            padding: 5px 10px;
            background: #e53935;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }



        .delete-btn:hover {
            background: #c62828;
        }

        .comic-delete-form {
            margin-top: 10px;
        }

        .hidden {
            display: none;
        }
    </style>

    <script>
        // „Ç≥„Éü„ÉÉ„ÇØ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Åü„Çâ„Ç≥„Éû‰∏ÄË¶ß„ÇíÈñãÈñâ
        function toggleKomas(id) {
            const section = document.getElementById("koma-section-" + id);
            section.classList.toggle("hidden");
        }
    </script>
</head>

<body>

    <h1>ÁÆ°ÁêÜÁîªÈù¢ - Comic ‰∏ÄË¶ß</h1>

    {% for comic in comics %}
    <div class="comic-box">

        <!-- üìå „Ç≥„Éü„ÉÉ„ÇØ„Éò„ÉÉ„ÉÄÔºà„ÇØ„É™„ÉÉ„ÇØ„ÅßÂ±ïÈñãÔºâ -->
        <div class="comic-header {% if comic.is_deleted %}deleted{% endif %}" onclick="toggleKomas({{ comic.id }})">
            {% if comic.is_deleted %}
            <span class="deleted-badge-comic">ÂâäÈô§Ê∏à</span>
            {% endif %}

            {% set latest_koma = comic.komas.order_by(Koma.frame_number).first() %}
            {% if latest_koma %}
            <!-- python „É≠„Éº„Ç´„É´Áí∞Â¢É„Åß„ÅØ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éï„Ç©„É´„ÉÄ„ÇíÁîªÂÉè„ÇΩ„Éº„ÇπÂÖÉ„Åß„Çà„Åã„Å£„Åü -->
            <!-- <img class="thumb" src="{{ url_for('static', filename='uploads/' ~ latest_koma.image_filename) }}"> -->
            <img class="thumb" src="latest_koma.image_filename">
            {% else %}
            <div class="thumb"></div>
            {% endif %}

            <div>
                <div class="comic-title">{{ comic.title }}</div>
                <div>{{ comic.komas.count() }} „Ç≥„Éû</div>
            </div>
        </div>
        {% if not comic.is_deleted %}
        <!-- „Ç≥„Éü„ÉÉ„ÇØÂâäÈô§ -->
        <form class="comic-delete-form" action="{{ url_for('delete_comic', comic_id=comic.id) }}" method="POST"
            onsubmit="event.stopPropagation(); return confirm('„Åì„ÅÆ„Ç≥„Éü„ÉÉ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„ÅôÔºà„ÇΩ„Éï„Éà„Éá„É™„Éº„ÉàÔºâ„ÄÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü');">
            <button class="delete-btn" onclick="event.stopPropagation();">
                „Ç≥„Éü„ÉÉ„ÇØÂâäÈô§
            </button>
        </form>
        {% endif %}

        <!-- ‚ñº‚ñº‚ñº „Ç≥„Éû‰∏ÄË¶ß ‚ñº‚ñº‚ñº -->
        <div id="koma-section-{{ comic.id }}" class="koma-grid hidden">

            {% for koma in comic.komas.order_by(Koma.frame_number).all() %}
            <div class="koma-card {% if koma.is_deleted %}deleted{% endif %}">

                {% if koma.is_deleted %}
                <span class="deleted-badge">ÂâäÈô§Ê∏à</span>
                {% endif %}


                <!-- python „É≠„Éº„Ç´„É´Áí∞Â¢É„Åß„ÅØflask„ÅÆ‰ªïÊßò„Åß„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éá„Ç£„É¨„ÇØ„Éà„É™„Åß„Çà„Åã„Å£„Åü -->
                <!-- <img src="{{ url_for('static', filename='uploads/' ~ koma.image_filename) }}"> -->
                <img src="koma.image_filename">

                <div>„Ç≥„Éû {{ koma.frame_number }}</div>

                <!-- „Ç≥„ÉûÂâäÈô§ÔºàÂâäÈô§Ê∏à„Åø„Å™„Çâ„Éú„Çø„É≥„ÇíÊ∂à„ÅôÔºâ -->
                {% if not koma.is_deleted %}
                <form action="{{ url_for('delete_koma', koma_id=koma.id) }}" method="POST"
                    onsubmit="event.stopPropagation(); return confirm('„Ç≥„Éû {{ koma.frame_number }} „ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü');">
                    <button class="delete-btn" onclick="event.stopPropagation();">
                        „Ç≥„ÉûÂâäÈô§
                    </button>
                </form>
                {% endif %}

            </div>
            {% endfor %}

        </div>
        <!-- ‚ñ≤‚ñ≤‚ñ≤ „Ç≥„Éû‰∏ÄË¶ß ‚ñ≤‚ñ≤‚ñ≤ -->

    </div>
    {% endfor %}

</body>

</html>