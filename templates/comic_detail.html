<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <script src="https://cdn.tailwindcss.com"></script>
  <title>{{ comic.title }} - 詳細</title>
</head>

<body class="bg-gray-100 p-4 md:p-8">
  <div class="max-w-3xl mx-auto">

    <!-- ヘッダー -->
    <header class="mb-6">
      <h1 class="text-3xl font-bold text-indigo-700">{{ comic.title }}</h1>
      <p class="text-gray-600">開始日: {{ comic.started_at.strftime('%Y/%m/%d') }}</p>

      <!-- トップページへ戻る -->
      <a href="{{ url_for('index') }}"
        class="inline-block mt-3 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg shadow hover:bg-gray-300">
        ← トップページへ戻る
      </a>
    </header>

    <!-- コマ一覧 -->
    <section class="bg-white p-4 rounded-xl shadow mb-6">
      <h2 class="text-xl font-bold mb-3">これまでのコマ</h2>

      <div class="space-y-6">
        {% for koma in komas %}
        <div class="border rounded-lg overflow-hidden bg-gray-50 shadow">
          <img class="w-full" src="{{ url_for('static', filename='uploads/' ~ koma.image_filename) }}" alt="">

          <div class="p-2 text-gray-600 text-sm">
            コマ番号：{{ koma.frame_number }}　
            投稿日：{{ koma.posted_at.strftime('%Y/%m/%d %H:%M') }}
          </div>
        </div>
        {% endfor %}
      </div>
    </section>

    <!-- 続きを投稿フォーム -->
    <section class="mt-12">

      <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-100">
        続きを投稿する
      </h2>

      {% set is_full = comic.max_koma is not none and koma_count >= comic.max_koma %}

      <div class="
      rounded-xl p-6 border
      bg-white
      border-gray-200
      transition
      {% if is_full %}
        opacity-50 pointer-events-none
      {% endif %}
    ">

        <form action="{{ url_for('post_frame') }}" method="POST" enctype="multipart/form-data" class="space-y-4">
          <input type="hidden" name="comic_id" value="{{ comic.id }}">

          <input type="file" name="file" required class="block w-full text-sm text-gray-500
               file:mr-4 file:py-2 file:px-4
               file:rounded-full file:border-0
               file:text-sm file:font-semibold
               file:bg-indigo-50 file:text-indigo-700
               hover:file:bg-indigo-100">

          <button type="submit" class="px-4 py-2 rounded-lg font-semibold
               bg-indigo-600 text-white
               hover:bg-indigo-700 transition">
            投稿
          </button>

        </form>

      </div>

      {% if is_full %}
      <p class="mt-3 text-sm text-gray-500 text-center">
        この漫画リレーは現在コマ上限に達しています。<br>
        続きを投稿したい場合は、作者に上限拡張をリクエストしてください。
      </p>
      {% endif %}

    </section>


  </div>
</body>

</html>